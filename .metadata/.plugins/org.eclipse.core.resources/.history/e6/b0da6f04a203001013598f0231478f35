package com.lms.attendance.controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.lms.attendance.model.Exam;
import com.lms.attendance.service.ExamService;

import lombok.RequiredArgsConstructor;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/exams")
@RequiredArgsConstructor
public class ExamController {
    private final ExamService examService;

    // ìƒˆë¡œìš´ ì‹œí—˜ ì¶”ê°€ (ì‹œí—˜ê³¼ ì§ˆë¬¸ í¬í•¨)
    @PostMapping
    public ResponseEntity<String> createExam(@RequestBody Exam exam) {
        System.out.println("ì‹œí—˜ ë°ì´í„°: " + exam); // ì „ì†¡ ë°ì´í„° í™•ì¸
        examService.createExam(exam);  // ì‹œí—˜ê³¼ ê´€ë ¨ëœ ì§ˆë¬¸ë“¤ê¹Œì§€ ì €ì¥
        return ResponseEntity.ok("ì‹œí—˜ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // íŠ¹ì • í´ë˜ìŠ¤ì˜ ì‹œí—˜ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    @GetMapping
    public ResponseEntity<List<Exam>> getExams(@RequestParam int classId) {
        System.out.println("ğŸ” ìš”ì²­ ë°›ì€ classId: " + classId);  // classId ê°’ í™•ì¸
        List<Exam> exams = examService.getExamsByClassId(classId);
        System.out.println("ğŸ” ê°€ì ¸ì˜¨ ì‹œí—˜ ëª©ë¡: " + exams);  // ê°€ì ¸ì˜¨ ë°ì´í„° í™•ì¸
        return ResponseEntity.ok(exams);
    }

    // íŠ¹ì • ì‹œí—˜ ìƒì„¸ ë³´ê¸° (ì‹œí—˜ê³¼ ì§ˆë¬¸ í¬í•¨)
    @GetMapping("/{examId}")
    public ResponseEntity<Exam> getExam(@PathVariable int examId) {
        System.out.println("ğŸ” ìš”ì²­ ë°›ì€ examId: " + examId);
        Exam exam = examService.getExamById(examId);  // ì‹œí—˜ê³¼ ê´€ë ¨ëœ ì§ˆë¬¸ì„ í•¨ê»˜ ê°€ì ¸ì˜´
        System.out.println("ğŸ” ê°€ì ¸ì˜¨ ì‹œí—˜ ë°ì´í„°: " + exam);
        return ResponseEntity.ok(exam);
    }

    // ì‹œí—˜ ì‚­ì œ (ì‹œí—˜ê³¼ ê´€ë ¨ëœ ì§ˆë¬¸ë„ ì‚­ì œ)
    @DeleteMapping("/{examId}")
    public ResponseEntity<Void> deleteExam(@PathVariable int examId) {
        examService.deleteExam(examId);  // ì‹œí—˜ê³¼ ê´€ë ¨ëœ ì§ˆë¬¸ë„ í•¨ê»˜ ì‚­ì œ
        return ResponseEntity.ok().build();
    }

    // ì‹œí—˜ ìˆ˜ì • (ì‹œí—˜ê³¼ ì§ˆë¬¸ í¬í•¨)
    @PutMapping("/{examId}")
    public ResponseEntity<Exam> updateExam(@PathVariable int examId, @RequestBody Exam exam) {
        System.out.println("ìˆ˜ì • ìš”ì²­ ë°ì´í„°: " + exam);  // ë¡œê·¸ ì°ì–´ì„œ ë°ì´í„° í™•ì¸
        exam.setExamId(examId); // examIdë¥¼ exam ê°ì²´ì— ì„¤ì •
        examService.updateExam(exam);  // ì‹œí—˜ê³¼ ì§ˆë¬¸ ìˆ˜ì •
        return ResponseEntity.ok(exam); // ìˆ˜ì •ëœ ì‹œí—˜ ê°ì²´ ë°˜í™˜
    }
}